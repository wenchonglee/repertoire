datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//-------------------
// Runs
//-------------------
model PlaywrightRuns {
  id           String              @id @default(auto()) @map("_id") @db.ObjectId
  runId        String              @unique
  startTime    DateTime
  endTime      DateTime?
  status       PlaywrightRunStatus @default(running)
  projects     String[]
  totalShards  Int
  joinedShards Int[]
  version      String
}

enum PlaywrightRunStatus {
  passed
  failed
  timedout
  interrupted
  running // Non-native status
}

//-------------------
// Tests
//-------------------
model PlaywrightTests {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // Attributes on run start
  runId          String
  projectName    String
  fileName       String
  testId         String
  title          String
  groupTitle     String?
  tags           String[]
  titlePath      String[]
  timeout        Int
  annotations    PlaywrightAnnotation[]
  expectedStatus PlaywrightTestStatus

  // Added attributes on test start
  startTime DateTime?
  duration  Int?
  retries   Int?
  outcome   PlaywrightOutcome?

  // Added attributes on test end
  errors  String?
  endTime DateTime?

  @@unique([runId, testId])
}

type PlaywrightAnnotation {
  type        String
  description String?
}

enum PlaywrightOutcome {
  skipped
  expected
  unexpected
  flaky
}

enum PlaywrightTestStatus {
  passed
  failed
  timedOut
  skipped
  interrupted
}
